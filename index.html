<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ò–≥—Ä–æ–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body {
    font-family: Arial, sans-serif;
    background: #1e1e1e;
    color: #fff;
    padding: 20px;
}

h1 { text-align: center; }

.add-player {
    max-width: 400px;
    margin: 0 auto 20px;
    background: #2b2b2b;
    padding: 15px;
    border-radius: 10px;
}

.add-player input {
    width: 100%;
    padding: 8px;
    margin-bottom: 10px;
    border-radius: 5px;
    border: none;
}

.add-player button {
    width: 100%;
    padding: 10px;
    border: none;
    border-radius: 5px;
    background: #4caf50;
    color: white;
    cursor: pointer;
}

.players {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    justify-content: center;
}

.profile {
    background: #2b2b2b;
    padding: 15px;
    border-radius: 10px;
    width: 280px;
    text-align: center;
}

.profile-header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #ff4d4d;
}

.mute-btn {
    margin-top: 10px;
    padding: 7px 14px;
    border: none;
    border-radius: 5px;
    background: #ff4d4d;
    color: white;
    cursor: pointer;
}

.mute-btn:disabled {
    background: gray;
    cursor: not-allowed;
}

.counter { margin-top: 8px; }

.ban-message {
    margin-top: 8px;
    padding: 8px;
    background: #ff3333;
    border-radius: 5px;
    display: none;
    font-size: 13px;
}

.timer {
    margin-top: 5px;
    font-size: 12px;
}
</style>
</head>
<body>

<h1>–ò–≥—Ä–æ–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞</h1>

<div class="add-player">
    <input id="nickname" placeholder="–ù–∏–∫ –∏–≥—Ä–æ–∫–∞">
    <input id="avatarUrl" placeholder="URL –∞–≤–∞—Ç–∞—Ä–∫–∏">
    <button onclick="addPlayer()">–î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞</button>
</div>

<div class="players" id="players"></div>

<script>
/* üîë –í–°–¢–ê–í–¨ –°–í–û–ò –î–ê–ù–ù–´–ï SUPABASE */
const supabase = window.supabase.createClient(
    "https://bhkuhygxynltevnagwbs.supabase.co",
    "sb_publishable_gxHDoyOaiUnoyKaIOK9eWw_lcem_lmO"
);

const playersContainer = document.getElementById("players");

/* –ó–ê–ì–†–£–ó–ö–ê –ò–ì–†–û–ö–û–í */
async function loadPlayers() {
    const { data } = await supabase
        .from("players")
        .select("*")
        .order("id", { ascending: false });

    playersContainer.innerHTML = "";

    data.forEach(renderPlayer);
}

/* –û–¢–†–ò–°–û–í–ö–ê –ò–ì–†–û–ö–ê */
function renderPlayer(player) {
    const profile = document.createElement("div");
    profile.className = "profile";

    profile.innerHTML = `
        <div class="profile-header">
            <img class="avatar" src="${player.avatar}">
            <h3>${player.name}</h3>
        </div>

        <button class="mute-btn">–í—ã–¥–∞—Ç—å –º—É—Ç</button>

        <div class="counter">
            –ú—É—Ç—ã: <span>${player.mutes}</span>
        </div>

        <div class="ban-message">
            –ë–∞–Ω –∑–∞ –ü.–ü. 2.2 
            –ü–æ–¥—É–º–∞–π –æ —Å–≤–æ–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–∏. –ù–µ–≥–æ–¥—è–π!
            –ò–ª–∏ –∏—Å–ø—ã—Ç–∞–π —É–¥–∞—á—É...
            <div class="timer"></div>
        </div>
    `;

    playersContainer.appendChild(profile);

    const muteBtn = profile.querySelector(".mute-btn");
    const counter = profile.querySelector("span");
    const banMessage = profile.querySelector(".ban-message");
    const timer = profile.querySelector(".timer");

    if (player.ban_end && player.ban_end > Date.now()) {
        muteBtn.disabled = true;
        banMessage.style.display = "block";
        startTimer(player, timer, muteBtn, banMessage);
    }

    muteBtn.onclick = async () => {
        const newMutes = player.mutes + 1;
        let banEnd = player.ban_end;

        if (newMutes % 3 === 0) {
            banEnd = Date.now() + 12 * 60 * 60 * 1000;
        }

        await supabase.from("players").update({
            mutes: newMutes,
            ban_end: banEnd
        }).eq("id", player.id);

        loadPlayers();
    };
}

/* –¢–ê–ô–ú–ï–† –ë–ê–ù–ê */
function startTimer(player, timer, button, message) {
    const interval = setInterval(() => {
        const left = player.ban_end - Date.now();

        if (left <= 0) {
            clearInterval(interval);
            button.disabled = false;
            message.style.display = "none";
            return;
        }

        const h = Math.floor(left / 3600000);
        const m = Math.floor((left % 3600000) / 60000);
        const s = Math.floor((left % 60000) / 1000);

        timer.textContent = `–î–æ –∫–æ–Ω—Ü–∞ –±–∞–Ω–∞: ${h}—á ${m}–º ${s}—Å`;
    }, 1000);
}

/* –î–û–ë–ê–í–õ–ï–ù–ò–ï –ò–ì–†–û–ö–ê */
async function addPlayer() {
    const name = nickname.value.trim();
    const avatar = avatarUrl.value.trim();

    if (!name || !avatar) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è");

    await supabase.from("players").insert({
        id: Date.now(),
        name,
        avatar,
        mutes: 0,
        ban_end: null
    });

    nickname.value = "";
    avatarUrl.value = "";

    loadPlayers();
}

loadPlayers();
</script>

</body>
</html>
